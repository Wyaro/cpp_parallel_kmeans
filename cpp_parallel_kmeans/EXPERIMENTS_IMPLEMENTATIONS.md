# Реализации для каждого эксперимента

## Общая информация

Все эксперименты используют функцию `get_all_implementations()`, которая возвращает список реализаций в зависимости от флага `--gpu-only`.

### Без флага `--gpu-only` (по умолчанию):
1. **cpp_cpu** - Однопоточная CPU реализация (baseline)
2. **cpp_cpu_openmp** - Многопоточная CPU реализация с OpenMP
3. **cpp_cuda_v1** - CUDA V1 (базовая)
4. **cpp_cuda_v2** - CUDA V2 (оптимизированная с матричной формулой)
5. **cpp_cuda_v3** - CUDA V3 (float32, быстрая)
6. **cpp_cuda_v4** - CUDA V4 (raw kernels, самая быстрая)

### С флагом `--gpu-only`:
1. **cpp_cuda_v1**
2. **cpp_cuda_v2**
3. **cpp_cuda_v3**
4. **cpp_cuda_v4**

---

## Эксперимент 1: exp1_baseline_single

**Описание:** Baseline эксперимент с одним датасетом

**Датасет:**
- `base/N100000_D50_K8.txt` (N=100000, D=50, K=8)

**Реализации:** Все 6 реализаций (или 4 GPU, если `--gpu-only`)

**Параметры:**
- `repeats` - из конфигурации эксперимента
- `warmup` - из конфигурации эксперимента

**Порядок выполнения:**
1. cpp_cpu
2. cpp_cpu_openmp
3. cpp_cuda_v1
4. cpp_cuda_v2
5. cpp_cuda_v3
6. cpp_cuda_v4

---

## Эксперимент 2: exp2_scaling_n

**Описание:** Масштабирование по количеству точек (N)

**Датасеты:**
- `scaling_N/N1000_D50_K8.txt` (N=1000)
- `scaling_N/N100000_D50_K8.txt` (N=100000)
- `scaling_N/N1000000_D50_K8.txt` (N=1000000)
- `scaling_N/N5000000_D50_K8.txt` (N=5000000)

**Реализации:** Все 6 реализаций для каждого датасета

**Параметры:**
- `repeats` - зависит от N (из `REPEATS_SCALING_N`)
- `warmup` = 3

**Порядок выполнения:**
Для каждого датасета (в порядке возрастания N):
1. cpp_cpu
2. cpp_cpu_openmp
3. cpp_cuda_v1
4. cpp_cuda_v2
5. cpp_cuda_v3
6. cpp_cuda_v4

**Итого:** 4 датасета × 6 реализаций = 24 записи результатов

---

## Эксперимент 3: exp3_scaling_d

**Описание:** Масштабирование по размерности (D)

**Датасеты:**
- `scaling_D/N100000_D2_K8.txt` (D=2)
- `scaling_D/N100000_D10_K8.txt` (D=10)
- `scaling_D/N100000_D50_K8.txt` (D=50)
- `scaling_D/N100000_D200_K8.txt` (D=200)

**Реализации:** Все 6 реализаций для каждого датасета

**Параметры:**
- `repeats` - зависит от D (из `REPEATS_SCALING_D`)
- `warmup` = 3

**Порядок выполнения:**
Для каждого датасета (в порядке возрастания D):
1. cpp_cpu
2. cpp_cpu_openmp
3. cpp_cuda_v1
4. cpp_cuda_v2
5. cpp_cuda_v3
6. cpp_cuda_v4

**Итого:** 4 датасета × 6 реализаций = 24 записи результатов

---

## Эксперимент 4: exp4_scaling_k

**Описание:** Масштабирование по количеству кластеров (K)

**Датасеты:**
- `scaling_K/N100000_D50_K4.txt` (K=4)
- `scaling_K/N100000_D50_K8.txt` (K=8)
- `scaling_K/N100000_D50_K16.txt` (K=16)
- `scaling_K/N100000_D50_K32.txt` (K=32)

**Реализации:** Все 6 реализаций для каждого датасета

**Параметры:**
- `repeats` - зависит от K (из `REPEATS_SCALING_K`)
- `warmup` = 3

**Порядок выполнения:**
Для каждого датасета (в порядке возрастания K):
1. cpp_cpu
2. cpp_cpu_openmp
3. cpp_cuda_v1
4. cpp_cuda_v2
5. cpp_cuda_v3
6. cpp_cuda_v4

**Итого:** 4 датасета × 6 реализаций = 24 записи результатов

---

## Эксперимент 5: exp5_gpu_profile

**Описание:** GPU профилирование на большом датасете

**Датасет:**
- `scaling_N/N1000000_D50_K8.txt` (N=1000000, D=50, K=8)

**Реализации:** Все 6 реализаций (или 4 GPU, если `--gpu-only`)

**Параметры:**
- `repeats` - из конфигурации эксперимента
- `warmup` = 3

**Порядок выполнения:**
1. cpp_cpu
2. cpp_cpu_openmp
3. cpp_cuda_v1
4. cpp_cuda_v2
5. cpp_cuda_v3
6. cpp_cuda_v4

---

## Итоговая статистика для `all` (без `--gpu-only`)

| Эксперимент | Датасетов | Реализаций | Всего записей |
|-------------|-----------|------------|---------------|
| exp1_baseline_single | 1 | 6 | 6 |
| exp2_scaling_n | 4 | 6 | 24 |
| exp3_scaling_d | 4 | 6 | 24 |
| exp4_scaling_k | 4 | 6 | 24 |
| exp5_gpu_profile | 1 | 6 | 6 |
| **ИТОГО** | **14** | **6** | **84** |

## Итоговая статистика для `all --gpu-only`

| Эксперимент | Датасетов | Реализаций | Всего записей |
|-------------|-----------|------------|---------------|
| exp1_baseline_single | 1 | 4 | 4 |
| exp2_scaling_n | 4 | 4 | 16 |
| exp3_scaling_d | 4 | 4 | 16 |
| exp4_scaling_k | 4 | 4 | 16 |
| exp5_gpu_profile | 1 | 4 | 4 |
| **ИТОГО** | **14** | **4** | **56** |

---

## Описание реализаций

### CPU реализации

1. **cpp_cpu** - Однопоточная CPU
   - Простая последовательная реализация
   - Используется как baseline для сравнения
   - Нет параллелизации

2. **cpp_cpu_openmp** - Многопоточная CPU с OpenMP
   - Параллелизация через OpenMP
   - Автоматическое определение количества потоков (или задается вручную)
   - Ускорение на многоядерных CPU

### GPU реализации (CUDA)

3. **cpp_cuda_v1** - CUDA V1 (базовая)
   - Прямое вычисление расстояний через broadcast
   - Материализация полного тензора diff (N × K × D)

4. **cpp_cuda_v2** - CUDA V2 (оптимизированная)
   - Использует матричную формулу: ||x||² + ||c||² - 2x·c
   - Избегает материализации diff
   - Вычисление x_sq и c_sq на GPU

5. **cpp_cuda_v3** - CUDA V3 (float32)
   - Использует float32 вместо double
   - Меньший трафик памяти
   - Быстрее вычисления на GPU

6. **cpp_cuda_v4** - CUDA V4 (raw kernels)
   - Ручная оптимизация CUDA kernels
   - Использует `__restrict__` и `#pragma unroll`
   - atomicAdd для суммирования
   - Самая быстрая версия

---

## Примеры запуска

### Все реализации (CPU + GPU):
```bash
x64\Debug\cpp_parallel_kmeans.exe all --output results.json
```

### Только GPU:
```bash
x64\Debug\cpp_parallel_kmeans.exe all --gpu-only --output results.json
```

### Отдельный эксперимент:
```bash
x64\Debug\cpp_parallel_kmeans.exe experiment exp1_baseline_single --output baseline.json
```

